<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <title>ReuniteIt | Reuniting Lost Items</title> -->
    <title>
        <%= title %>
    </title>
    <meta name="keywords"
        content="lost and found, lost items, found items, reunite belongings, missing things, lost wallet, lost phone">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- OPEN GRAPH (for WhatsApp, Instagram, LinkedIn shares) -->
    <meta property="og:title" content="<%= title %>">

    <meta property="og:description" content="<%= (typeof description !== 'undefined')
        ? description
        : 'A platform to report and find lost and found items.' %>">
    <meta property="og:type" content="website">
    <meta name="google-site-verification" content="-SXHm07ei6eO0dFyQcA98JvuLPSoUb2FV-_NqcMnXuc" />
    <!-- TWITTER CARD -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= title %>">
    <meta name="twitter:description" content="<%= description %>">

    <!-- JSON-LD (Structured Data - Google loves this) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "ReuniteIt",
      "description": "A modern Lost & Found platform to report, discover, and recover lost items.",
      "url": "https://reuniteit.onrender.com/"
    }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Chiron+Sung+HK:ital,wght@0,200..900;1,200..900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Noto+Sans+JP:wght@100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=WDXL+Lubrifont+JP+N&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans&family=Space+Grotesk:wght@500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="/images/image.png" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXX"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-21TMS1BHW2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-21TMS1BHW2');
    </script>

</head>

<body>
    <% if (typeof hideAuthNav !=='undefined' && hideAuthNav) { %>
        <%- include('../partials/navbar') %>
            <% } else { %>
                <% if (currentUser) { %>
                    <%- include('../partials/navbar-auth') %>
                        <% } else { %>
                            <%- include('../partials/navbar') %>
                                <% } %>
                                    <% } %>


                                        <main>
                                            <%- body %>
                                        </main>

                                        <%- include('../partials/footer') %>

                                            <script src="/script.js"></script>
                                            <script
                                                src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

                                            <script>
                                                (function () {
                                                    const KEY = 'reuniteit_auth_sync';
                                                    const seenKey = 'reuniteit_seen_stamp';
                                                    const isLoggedIn = <%= currentUser ? 'true' : 'false' %>;
                                                    const onDashboard = window.location.pathname === '/dashboard';

                                                    try {
                                                        // Only signal other tabs when we are on the dashboard *and* server says we're logged in.
                                                        // This avoids unnecessary reloads on every page load.
                                                        if (onDashboard && isLoggedIn === true) {
                                                            // prevent double-signalling from same tab
                                                            const alreadySeen = sessionStorage.getItem(seenKey);
                                                            if (!alreadySeen || alreadySeen.indexOf('|dashboard|') === -1) {
                                                                const payload = 'dashboard|' + Date.now(); // unique value
                                                                localStorage.setItem(KEY, payload);
                                                                sessionStorage.setItem(seenKey, payload);
                                                            }
                                                        }
                                                    } catch (e) {
                                                        console.warn('reuniteit sync error', e);
                                                    }

                                                    // When another tab signals, reload to fetch fresh server-rendered HTML
                                                    window.addEventListener('storage', function (e) {
                                                        if (e.key === KEY && e.newValue) {
                                                            try {
                                                                const mySeen = sessionStorage.getItem(seenKey);
                                                                if (!mySeen || mySeen !== e.newValue) {
                                                                    // Mark we saw it so we don't loop
                                                                    sessionStorage.setItem(seenKey, e.newValue);
                                                                    // Reload to pick up server-rendered auth state (cookie is HttpOnly, server will read it)
                                                                    location.reload();
                                                                }
                                                            } catch (err) {
                                                                location.reload();
                                                            }
                                                        }
                                                    }, false);
                                                })();
                                            </script>

</body>

</html>